{
  "dashboard_name": "Account Monitor - IBM Style",
  "description": "Comprehensive account monitoring dashboard matching IBM Account Monitor layout with contract burndown tracking",
  "layout_type": "single_page",
  "filters": [
    {
      "name": "account_filter",
      "type": "dropdown",
      "label": "Account",
      "dataset": "account_list",
      "field": "customer_name",
      "default": "first",
      "applies_to": ["all"]
    },
    {
      "name": "date_range",
      "type": "date_range",
      "label": "Date Range",
      "default": "Last 12 months",
      "applies_to": ["total_spend_timeframe", "contract_burndown_chart"]
    },
    {
      "name": "sku_count",
      "type": "number_input",
      "label": "top_sku_count",
      "default": 5,
      "applies_to": ["top_metrics"]
    }
  ],
  "datasets": [
    {
      "name": "top_sku_count",
      "query": "SELECT COUNT(DISTINCT sku_name) as top_sku_count FROM system.billing.usage WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365)"
    },
    {
      "name": "top_workspace_count",
      "query": "SELECT COUNT(DISTINCT workspace_id) as top_workspace_count FROM system.billing.usage WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365)"
    },
    {
      "name": "latest_date",
      "query": "SELECT MAX(usage_date) as date FROM system.billing.usage"
    },
    {
      "name": "data_freshness",
      "query": "SELECT 'Consumption' as source, MAX(usage_date) as latest_date, CASE WHEN DATEDIFF(CURRENT_DATE(), MAX(usage_date)) <= 2 THEN 'True' ELSE 'False' END as verified FROM system.billing.usage UNION ALL SELECT 'Metrics' as source, MAX(usage_date) as latest_date, CASE WHEN DATEDIFF(CURRENT_DATE(), MAX(usage_date)) <= 2 THEN 'True' ELSE 'False' END as verified FROM system.billing.usage"
    },
    {
      "name": "account_info",
      "query": "SELECT customer_name as 'Customer', salesforce_id as 'Salesforce ID', business_unit_l0 as 'Business Unit L0', business_unit_l1 as 'Business Unit L1', business_unit_l2 as 'Business Unit L2', business_unit_l3 as 'Business Unit L3', account_executive as 'Account Executive', solutions_architect as 'Solutions Architect', delivery_solutions_architect as 'Delivery Solutions Architect' FROM main.account_monitoring_dev.account_metadata LIMIT 1"
    },
    {
      "name": "total_spend_timeframe",
      "query": "SELECT customer_name as 'Customer Name', cloud_provider as 'Cloud', MIN(usage_date) as 'Start Date', MAX(usage_date) as 'End Date', ROUND(SUM(usage_quantity), 0) as 'DBU', CONCAT('$', FORMAT_NUMBER(ROUND(SUM(list_price), 2), 2)) as 'List Price', CONCAT('$', FORMAT_NUMBER(ROUND(SUM(discounted_price), 2), 2)) as 'Discounted Price', CONCAT('$', FORMAT_NUMBER(ROUND(SUM(actual_cost), 2), 2)) as 'Revenue' FROM main.account_monitoring_dev.dashboard_data WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY customer_name, cloud_provider ORDER BY cloud_provider"
    },
    {
      "name": "contracts_table",
      "query": "SELECT cloud_provider as 'Platform', contract_id as 'Contract ID', start_date as 'Start', end_date as 'End', CONCAT('$', FORMAT_NUMBER(commitment, 0)) as 'Total Value', CASE WHEN total_consumed IS NULL THEN 'null' ELSE CONCAT('$', FORMAT_NUMBER(total_consumed, 2)) END as 'Consumed', CASE WHEN consumed_pct IS NULL THEN 'null' ELSE CONCAT(ROUND(consumed_pct, 1), '%') END as 'Consumed %' FROM main.account_monitoring_dev.contract_burndown_summary ORDER BY start_date"
    },
    {
      "name": "contract_burndown_chart",
      "query": "SELECT usage_date as date, ROUND(SUM(commitment), 2) as commit, ROUND(SUM(cumulative_cost), 2) as consumption FROM main.account_monitoring_dev.contract_burndown WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY usage_date ORDER BY usage_date"
    }
  ],
  "page": {
    "name": "Account Monitor",
    "description": "Comprehensive account overview with contract tracking and burndown visualization",
    "layout": [
      {
        "row": 1,
        "description": "Top metrics and data freshness",
        "components": [
          {
            "component": "counter",
            "title": "top_sku_count",
            "dataset": "top_sku_count",
            "field": "top_sku_count",
            "position": {"x": 0, "y": 0, "w": 2, "h": 2}
          },
          {
            "component": "counter",
            "title": "top_workspace_count",
            "dataset": "top_workspace_count",
            "field": "top_workspace_count",
            "position": {"x": 2, "y": 0, "w": 2, "h": 2}
          },
          {
            "component": "counter",
            "title": "date",
            "dataset": "latest_date",
            "field": "date",
            "format": "date",
            "position": {"x": 4, "y": 0, "w": 2, "h": 2}
          },
          {
            "component": "table",
            "title": "Latest Data Dates",
            "dataset": "data_freshness",
            "columns": ["source", "latest_date", "verified"],
            "conditional_formatting": [
              {
                "column": "verified",
                "condition": "equals",
                "value": "False",
                "style": {"background": "#ffcdd2"}
              },
              {
                "column": "verified",
                "condition": "equals",
                "value": "True",
                "style": {"background": "#c8e6c9"}
              }
            ],
            "position": {"x": 6, "y": 0, "w": 6, "h": 2}
          }
        ]
      },
      {
        "row": 2,
        "description": "Account information",
        "components": [
          {
            "component": "table",
            "title": "Account Info",
            "dataset": "account_info",
            "layout": "horizontal",
            "show_headers": true,
            "position": {"x": 0, "y": 2, "w": 12, "h": 2}
          }
        ]
      },
      {
        "row": 3,
        "description": "Total spending by cloud provider",
        "components": [
          {
            "component": "table",
            "title": "Total Spend in Timeframe",
            "dataset": "total_spend_timeframe",
            "columns": ["Customer Name", "Cloud", "Start Date", "End Date", "DBU", "List Price", "Discounted Price", "Revenue"],
            "sortable": true,
            "position": {"x": 0, "y": 4, "w": 12, "h": 3}
          }
        ]
      },
      {
        "row": 4,
        "description": "Contracts and burndown visualization",
        "components": [
          {
            "component": "table",
            "title": "Contracts",
            "dataset": "contracts_table",
            "columns": ["Platform", "Contract ID", "Start", "End", "Total Value", "Consumed", "Consumed %"],
            "conditional_formatting": [
              {
                "column": "Consumed %",
                "condition": "greater_than",
                "value": "80%",
                "style": {"background": "#fff9c4"}
              },
              {
                "column": "Consumed %",
                "condition": "greater_than",
                "value": "90%",
                "style": {"background": "#ffcdd2"}
              }
            ],
            "position": {"x": 0, "y": 7, "w": 6, "h": 6}
          },
          {
            "component": "line_chart",
            "title": "Contract Burndown",
            "dataset": "contract_burndown_chart",
            "x_axis": "date",
            "y_axes": [
              {
                "column": "commit",
                "label": "Commit",
                "color": "#757575",
                "style": "solid"
              },
              {
                "column": "consumption",
                "label": "Consumption",
                "color": "#FF9800",
                "style": "solid"
              }
            ],
            "legend": true,
            "legend_position": "bottom",
            "x_axis_label": "Date",
            "y_axis_label": "DBU ($)",
            "position": {"x": 6, "y": 7, "w": 6, "h": 6}
          }
        ]
      }
    ]
  },
  "refresh_schedule": {
    "frequency": "daily",
    "time": "03:00",
    "timezone": "UTC",
    "description": "Refreshes at 3 AM UTC, 1 hour after data refresh job"
  },
  "permissions": {
    "can_view": ["all_users"],
    "can_edit": ["account_admins"],
    "can_manage": ["account_admins"]
  },
  "notes": {
    "layout": "IBM Account Monitor style - single comprehensive page",
    "total_visualizations": 8,
    "filters": 3,
    "estimated_creation_time": "45-60 minutes",
    "key_features": [
      "Account overview with key metrics",
      "Data freshness validation",
      "Comprehensive account information",
      "Cloud provider spending breakdown",
      "Contract tracking with consumption %",
      "Contract burndown visualization"
    ]
  }
}
