{
  "datasets": [
    {
      "name": "ds_executive_summary",
      "displayName": "Executive Summary",
      "queryLines": [
        "SELECT SUM(commitment) as total_contract_value, SUM(total_consumed) as total_consumed, SUM(budget_remaining) as remaining_budget, COUNT(*) as contract_count FROM main.account_monitoring_dev.contract_burndown_summary"
      ]
    },
    {
      "name": "ds_pace_distribution",
      "displayName": "Pace Distribution",
      "queryLines": [
        "SELECT pace_status, COUNT(*) as contract_count FROM main.account_monitoring_dev.contract_burndown_summary GROUP BY pace_status ORDER BY CASE WHEN pace_status LIKE '%OVER%' THEN 1 WHEN pace_status LIKE '%ABOVE%' THEN 2 WHEN pace_status LIKE '%ON PACE%' THEN 3 ELSE 4 END"
      ]
    },
    {
      "name": "ds_combined_burndown",
      "displayName": "Combined Burndown",
      "queryLines": [
        "WITH daily_data AS (SELECT usage_date, SUM(cumulative_cost) as total_actual, SUM(commitment) as total_commitment FROM main.account_monitoring_dev.contract_burndown WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY usage_date), actuals AS (SELECT usage_date as date, total_actual as value, 'Actual Consumption' as series_type FROM daily_data), commitment AS (SELECT usage_date as date, total_commitment as value, 'Contract Commitment' as series_type FROM daily_data) SELECT * FROM actuals UNION ALL SELECT * FROM commitment ORDER BY date, series_type"
      ]
    },
    {
      "name": "ds_contract_burndown",
      "displayName": "Contract Burndown",
      "queryLines": [
        "WITH base_data AS (SELECT contract_id, usage_date, ROUND(cumulative_cost, 2) as actual_consumption, ROUND(commitment, 2) as contract_value FROM main.account_monitoring_dev.contract_burndown WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 180)), actuals AS (SELECT contract_id, usage_date as date, actual_consumption as value, CONCAT(contract_id, ' - Actual') as series_type FROM base_data), commitment AS (SELECT contract_id, usage_date as date, contract_value as value, CONCAT(contract_id, ' - Commitment') as series_type FROM base_data) SELECT * FROM actuals UNION ALL SELECT * FROM commitment ORDER BY contract_id, date, series_type"
      ]
    },
    {
      "name": "ds_contract_summary",
      "displayName": "Contract Summary",
      "queryLines": [
        "SELECT contract_id, cloud_provider, start_date, end_date, ROUND(commitment, 0) as contract_value, ROUND(total_consumed, 2) as consumed, ROUND(budget_remaining, 2) as remaining, ROUND(consumed_pct, 1) as consumed_pct, pace_status, days_remaining, projected_end_date FROM main.account_monitoring_dev.contract_burndown_summary ORDER BY consumed_pct DESC"
      ]
    },
    {
      "name": "ds_monthly_consumption",
      "displayName": "Monthly Consumption by Contract",
      "queryLines": [
        "SELECT DATE_TRUNC('MONTH', usage_date) as month, contract_id, SUM(daily_cost) as monthly_cost FROM main.account_monitoring_dev.contract_burndown WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY DATE_TRUNC('MONTH', usage_date), contract_id ORDER BY month, contract_id"
      ]
    },
    {
      "name": "ds_forecast_with_history",
      "displayName": "Forecast with History",
      "queryLines": [
        "WITH history AS (SELECT b.contract_id, b.usage_date as date, b.cumulative_cost as actual_value, CAST(NULL AS DOUBLE) as forecast_value, CAST(NULL AS DOUBLE) as lower_bound, CAST(NULL AS DOUBLE) as upper_bound, b.commitment as contract_commitment FROM main.account_monitoring_dev.contract_burndown b), forecast AS (SELECT f.contract_id, f.forecast_date as date, CAST(NULL AS DOUBLE) as actual_value, f.predicted_cumulative as forecast_value, f.lower_bound + (SELECT MAX(cumulative_cost) FROM main.account_monitoring_dev.contract_burndown WHERE contract_id = f.contract_id) as lower_bound, f.upper_bound + (SELECT MAX(cumulative_cost) FROM main.account_monitoring_dev.contract_burndown WHERE contract_id = f.contract_id) as upper_bound, c.total_value as contract_commitment FROM main.account_monitoring_dev.contract_forecast f JOIN main.account_monitoring_dev.contracts c ON f.contract_id = c.contract_id WHERE f.forecast_date > (SELECT MAX(usage_date) FROM main.account_monitoring_dev.contract_burndown WHERE contract_id = f.contract_id)) SELECT * FROM history UNION ALL SELECT * FROM forecast ORDER BY contract_id, date"
      ]
    },
    {
      "name": "ds_prophet_combined",
      "displayName": "Contract Burndown with ML Forecast",
      "queryLines": [
        "WITH contract_dates AS (SELECT contract_id, MIN(usage_date) as min_date, MAX(usage_date) as max_date, MAX(commitment) as commitment FROM main.account_monitoring_dev.contract_burndown GROUP BY contract_id), all_dates AS (SELECT DISTINCT contract_id, usage_date as date FROM main.account_monitoring_dev.contract_burndown UNION SELECT DISTINCT f.contract_id, f.forecast_date as date FROM main.account_monitoring_dev.contract_forecast f INNER JOIN contract_dates cd ON f.contract_id = cd.contract_id WHERE f.forecast_date > cd.max_date), actuals AS (SELECT b.contract_id, b.usage_date as date, b.cumulative_cost as value, 'Historical Consumption' as series_type FROM main.account_monitoring_dev.contract_burndown b), forecasts AS (SELECT f.contract_id, f.forecast_date as date, f.predicted_cumulative as value, 'ML Forecast (Prophet)' as series_type FROM main.account_monitoring_dev.contract_forecast f INNER JOIN contract_dates cd ON f.contract_id = cd.contract_id WHERE f.forecast_date > cd.max_date), commitment_line AS (SELECT ad.contract_id, ad.date, cd.commitment as value, 'Contract Commitment' as series_type FROM all_dates ad INNER JOIN contract_dates cd ON ad.contract_id = cd.contract_id) SELECT * FROM actuals UNION ALL SELECT * FROM forecasts UNION ALL SELECT * FROM commitment_line ORDER BY contract_id, date, series_type"
      ]
    },
    {
      "name": "ds_forecast_summary",
      "displayName": "Forecast Summary",
      "queryLines": [
        "SELECT f.contract_id, f.cloud_provider, f.contract_value, f.exhaustion_date_p10, f.exhaustion_date_p50, f.exhaustion_date_p90, f.days_to_exhaustion, f.forecast_status, f.contract_end FROM main.account_monitoring_dev.contract_forecast_details f WHERE f.forecast_date = (SELECT MAX(forecast_date) FROM main.account_monitoring_dev.contract_forecast WHERE contract_id = f.contract_id)"
      ]
    },
    {
      "name": "ds_contracts_at_risk",
      "displayName": "Contracts at Risk",
      "queryLines": [
        "SELECT COUNT(DISTINCT contract_id) as at_risk_count FROM main.account_monitoring_dev.contract_forecast_details WHERE forecast_status = 'AT RISK'"
      ]
    },
    {
      "name": "ds_product_category",
      "displayName": "Cost by Product Category",
      "queryLines": [
        "SELECT DATE_TRUNC('MONTH', usage_date) as month, product_category, ROUND(SUM(actual_cost), 2) as total_cost FROM main.account_monitoring_dev.dashboard_data WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY DATE_TRUNC('MONTH', usage_date), product_category ORDER BY month, product_category"
      ]
    },
    {
      "name": "ds_top_workspaces",
      "displayName": "Top Workspaces",
      "queryLines": [
        "SELECT workspace_id, cloud_provider, ROUND(SUM(actual_cost), 2) as total_cost, ROUND(SUM(usage_quantity), 2) as total_dbu, COUNT(DISTINCT sku_name) as unique_skus FROM main.account_monitoring_dev.dashboard_data WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 30) GROUP BY workspace_id, cloud_provider ORDER BY total_cost DESC LIMIT 10"
      ]
    },
    {
      "name": "ds_top_skus",
      "displayName": "Top SKUs",
      "queryLines": [
        "SELECT sku_name, cloud_provider, usage_unit, ROUND(SUM(usage_quantity), 2) as total_usage, ROUND(SUM(actual_cost), 2) as total_cost FROM main.account_monitoring_dev.dashboard_data WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 90) GROUP BY sku_name, cloud_provider, usage_unit ORDER BY total_cost DESC LIMIT 10"
      ]
    },
    {
      "name": "ds_monthly_by_cloud",
      "displayName": "Monthly Cost by Cloud",
      "queryLines": [
        "SELECT DATE_TRUNC('MONTH', usage_date) as month, cloud_provider, ROUND(SUM(actual_cost), 2) as monthly_cost FROM main.account_monitoring_dev.dashboard_data WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 365) GROUP BY DATE_TRUNC('MONTH', usage_date), cloud_provider ORDER BY month"
      ]
    },
    {
      "name": "ds_consumption_trend",
      "displayName": "Daily Consumption with Moving Average",
      "queryLines": [
        "SELECT usage_date, daily_cost, AVG(daily_cost) OVER (ORDER BY usage_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as moving_avg_7d, AVG(daily_cost) OVER (ORDER BY usage_date ROWS BETWEEN 29 PRECEDING AND CURRENT ROW) as moving_avg_30d FROM (SELECT usage_date, SUM(daily_cost) as daily_cost FROM main.account_monitoring_dev.contract_burndown GROUP BY usage_date) daily WHERE usage_date >= DATE_SUB(CURRENT_DATE(), 180) ORDER BY usage_date"
      ]
    },
    {
      "name": "ds_exhaustion_date",
      "displayName": "Contract Exhaustion Date",
      "queryLines": [
        "SELECT c.contract_id, c.start_date, c.end_date, c.total_value as commitment, COALESCE(f.exhaustion_date_p50, c.end_date) as predicted_exhaustion_date, CASE WHEN f.exhaustion_date_p50 IS NOT NULL THEN DATEDIFF(f.exhaustion_date_p50, CURRENT_DATE()) ELSE DATEDIFF(c.end_date, CURRENT_DATE()) END as days_until_exhaustion, f.model_version, CASE WHEN f.exhaustion_date_p50 < c.end_date THEN \"EARLY EXHAUSTION\" WHEN f.exhaustion_date_p50 > c.end_date THEN \"UNDER-CONSUMPTION\" ELSE \"ON TRACK\" END as exhaustion_status FROM main.account_monitoring_dev.contracts c LEFT JOIN (SELECT contract_id, exhaustion_date_p50, model_version FROM main.account_monitoring_dev.contract_forecast WHERE forecast_date = (SELECT MAX(forecast_date) FROM main.account_monitoring_dev.contract_forecast)) f ON c.contract_id = f.contract_id WHERE c.status = \"ACTIVE\""
      ]
    },
    {
      "name": "ds_whatif_scenarios",
      "displayName": "What-If Discount Scenarios",
      "queryLines": [
        "WITH scenario_data AS (SELECT sb.contract_id, sb.usage_date as date, sb.simulated_cumulative as value, ds.scenario_name as series_type, ds.discount_pct, ds.is_baseline FROM main.account_monitoring_dev.scenario_burndown sb JOIN main.account_monitoring_dev.discount_scenarios ds ON sb.scenario_id = ds.scenario_id WHERE ds.status = 'ACTIVE' AND ds.description NOT LIKE '%extended to%'), commitment_line AS (SELECT contract_id, usage_date as date, scenario_commitment as value, 'Contract Commitment' as series_type, 0 as discount_pct, FALSE as is_baseline FROM main.account_monitoring_dev.scenario_burndown WHERE scenario_id IN (SELECT scenario_id FROM main.account_monitoring_dev.discount_scenarios WHERE is_baseline = TRUE)) SELECT * FROM scenario_data UNION ALL SELECT * FROM commitment_line ORDER BY contract_id, date, discount_pct"
      ]
    },
    {
      "name": "ds_whatif_summary",
      "displayName": "What-If Summary",
      "queryLines": [
        "SELECT ss.contract_id, ss.scenario_name, ss.discount_pct, ROUND(ss.cumulative_savings, 0) as savings_to_date, ss.scenario_exhaustion_date, ss.days_extended, ROUND(ss.utilization_pct, 1) as utilization_pct, ss.exhaustion_status, CASE WHEN ss.is_sweet_spot THEN 'RECOMMENDED' ELSE '' END as recommendation FROM main.account_monitoring_dev.scenario_summary ss JOIN main.account_monitoring_dev.discount_scenarios ds ON ss.scenario_id = ds.scenario_id WHERE ds.status = 'ACTIVE' AND COALESCE(ds.description, '') NOT LIKE '%extended to%' ORDER BY ss.contract_id, ss.discount_pct"
      ]
    },
    {
      "name": "ds_whatif_longer_duration",
      "displayName": "Longer Duration Opportunities",
      "queryLines": [
        "SELECT ss.contract_id, ss.scenario_name as opportunity, ss.discount_pct as potential_discount, ROUND(ss.cumulative_savings, 0) as potential_savings, ss.days_extended as potential_days_extended, ds.description FROM main.account_monitoring_dev.scenario_summary ss JOIN main.account_monitoring_dev.discount_scenarios ds ON ss.scenario_id = ds.scenario_id WHERE ds.status = 'ACTIVE' AND ds.description LIKE '%extended to%' ORDER BY ss.contract_id, ss.discount_pct"
      ]
    },
    {
      "name": "ds_whatif_sweet_spot",
      "displayName": "Sweet Spot Recommendations",
      "queryLines": [
        "SELECT contract_id, scenario_name, discount_pct as best_discount, ROUND(cumulative_savings, 0) as savings, days_extended, ROUND(utilization_pct, 1) as utilization_pct FROM main.account_monitoring_dev.scenario_summary WHERE is_sweet_spot = TRUE"
      ]
    },
    {
      "name": "ds_discount_tiers",
      "displayName": "Discount Tiers Reference",
      "queryLines": [
        "SELECT tier_name, CONCAT('$', FORMAT_NUMBER(min_commitment, 0), ' - ', COALESCE(CONCAT('$', FORMAT_NUMBER(max_commitment, 0)), 'Unlimited')) as commitment_range, duration_years as years, CONCAT(CAST(discount_rate * 100 AS INT), '%') as max_discount FROM main.account_monitoring_dev.discount_tiers ORDER BY min_commitment, duration_years"
      ]
    }
  ],
  "pages": [
    {
      "name": "page_executive",
      "displayName": "Executive Summary",
      "layout": [
        {
          "widget": {
            "name": "w_total_value",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_executive_summary",
                  "fields": [
                    {
                      "name": "total_contract_value",
                      "expression": "`total_contract_value`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "total_contract_value",
                  "displayName": "Total Contract Value (USD)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Total Contract Value"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "w_total_consumed",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_executive_summary",
                  "fields": [
                    {
                      "name": "total_consumed",
                      "expression": "`total_consumed`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "total_consumed",
                  "displayName": "Total Consumed (USD)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Total Consumed"
              }
            }
          },
          "position": {
            "x": 2,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "w_remaining",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_executive_summary",
                  "fields": [
                    {
                      "name": "remaining_budget",
                      "expression": "`remaining_budget`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "counter",
              "encodings": {
                "value": {
                  "fieldName": "remaining_budget",
                  "displayName": "Remaining Budget (USD)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Remaining Budget"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 0,
            "width": 2,
            "height": 2
          }
        },
        {
          "widget": {
            "name": "w_pace_pie",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_pace_distribution",
                  "fields": [
                    {
                      "name": "contract_count",
                      "expression": "`contract_count`"
                    },
                    {
                      "name": "pace_status",
                      "expression": "`pace_status`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "pie",
              "encodings": {
                "angle": {
                  "fieldName": "contract_count",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Contract Count"
                },
                "color": {
                  "fieldName": "pace_status",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Pace Status"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Contract Pace Distribution"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 2,
            "width": 3,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "w_combined_burndown",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_combined_burndown",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    },
                    {
                      "name": "value",
                      "expression": "`value`"
                    },
                    {
                      "name": "series_type",
                      "expression": "`series_type`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "date",
                  "scale": {
                    "type": "temporal"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "value",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Total (USD)"
                },
                "color": {
                  "fieldName": "series_type",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": "Actual Consumption",
                        "color": "#FFD700"
                      },
                      {
                        "value": "Contract Commitment",
                        "color": "#00008B"
                      }
                    ]
                  },
                  "displayName": "Series"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Combined Contract Consumption - All Contracts"
              }
            }
          },
          "position": {
            "x": 3,
            "y": 2,
            "width": 3,
            "height": 4
          }
        },
        {
          "widget": {
            "name": "w_daily_trend",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_consumption_trend",
                  "fields": [
                    {
                      "name": "usage_date",
                      "expression": "`usage_date`"
                    },
                    {
                      "name": "daily_cost",
                      "expression": "`daily_cost`"
                    },
                    {
                      "name": "moving_avg_7d",
                      "expression": "`moving_avg_7d`"
                    },
                    {
                      "name": "moving_avg_30d",
                      "expression": "`moving_avg_30d`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "usage_date",
                  "scale": {
                    "type": "temporal"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "daily_cost",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Daily Cost (USD)"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Daily Consumption with Moving Averages (7d & 30d)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 6,
            "height": 4
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "page_burndown",
      "displayName": "Contract Burndown",
      "layout": [
        {
          "widget": {
            "name": "w_burndown_chart",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_contract_burndown",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    },
                    {
                      "name": "value",
                      "expression": "`value`"
                    },
                    {
                      "name": "series_type",
                      "expression": "`series_type`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "date",
                  "scale": {
                    "type": "temporal"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "value",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Cumulative Cost (USD)"
                },
                "color": {
                  "fieldName": "series_type",
                  "scale": {
                    "type": "categorical"
                  },
                  "displayName": "Series"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "Contract Burndown - Actual vs Commitment"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "w_prophet_burndown",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_prophet_combined",
                  "fields": [
                    {
                      "name": "series_type",
                      "expression": "`series_type`"
                    },
                    {
                      "name": "date",
                      "expression": "`date`"
                    },
                    {
                      "name": "value",
                      "expression": "`value`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "frame": {
                "showTitle": true,
                "title": "Contract Burndown with Prophet ML Forecast (from contract_forecast table)"
              },
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "date",
                  "displayName": "Date",
                  "scale": {
                    "type": "temporal"
                  }
                },
                "y": {
                  "fieldName": "value",
                  "displayName": "Cumulative Cost ($)",
                  "scale": {
                    "type": "quantitative"
                  }
                },
                "color": {
                  "fieldName": "series_type",
                  "displayName": "Series",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": "Historical Consumption",
                        "color": "#FFD700"
                      },
                      {
                        "value": "ML Forecast (Prophet)",
                        "color": "#FF0000"
                      },
                      {
                        "value": "Contract Commitment",
                        "color": "#00008B"
                      }
                    ]
                  }
                }
              }
            }
          },
          "position": {
            "x": 0,
            "y": 5,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "w_contract_table",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_contract_summary",
                  "fields": [
                    {
                      "name": "contract_id",
                      "expression": "`contract_id`"
                    },
                    {
                      "name": "cloud_provider",
                      "expression": "`cloud_provider`"
                    },
                    {
                      "name": "start_date",
                      "expression": "`start_date`"
                    },
                    {
                      "name": "end_date",
                      "expression": "`end_date`"
                    },
                    {
                      "name": "contract_value",
                      "expression": "`contract_value`"
                    },
                    {
                      "name": "consumed",
                      "expression": "`consumed`"
                    },
                    {
                      "name": "remaining",
                      "expression": "`remaining`"
                    },
                    {
                      "name": "consumed_pct",
                      "expression": "`consumed_pct`"
                    },
                    {
                      "name": "pace_status",
                      "expression": "`pace_status`"
                    },
                    {
                      "name": "days_remaining",
                      "expression": "`days_remaining`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "contract_id",
                    "displayName": "Contract ID",
                    "type": "string"
                  },
                  {
                    "fieldName": "cloud_provider",
                    "displayName": "Cloud",
                    "type": "string"
                  },
                  {
                    "fieldName": "start_date",
                    "displayName": "Start Date",
                    "type": "datetime",
                    "dateTimeFormat": "YYYY-MM-DD"
                  },
                  {
                    "fieldName": "end_date",
                    "displayName": "End Date",
                    "type": "datetime",
                    "dateTimeFormat": "YYYY-MM-DD"
                  },
                  {
                    "fieldName": "contract_value",
                    "displayName": "Commitment ($)",
                    "type": "number",
                    "numberFormat": "#,##0"
                  },
                  {
                    "fieldName": "consumed",
                    "displayName": "Consumed ($)",
                    "type": "number",
                    "numberFormat": "#,##0.00"
                  },
                  {
                    "fieldName": "remaining",
                    "displayName": "Remaining ($)",
                    "type": "number",
                    "numberFormat": "#,##0.00"
                  },
                  {
                    "fieldName": "consumed_pct",
                    "displayName": "% Used",
                    "type": "number",
                    "numberFormat": "0.0%"
                  },
                  {
                    "fieldName": "pace_status",
                    "displayName": "Pace Status",
                    "type": "string"
                  },
                  {
                    "fieldName": "days_remaining",
                    "displayName": "Days Left",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "Contract Details & Status"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 10,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "w_exhaustion_date",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_exhaustion_date",
                  "fields": [
                    {
                      "name": "contract_id",
                      "expression": "`contract_id`"
                    },
                    {
                      "name": "commitment",
                      "expression": "`commitment`"
                    },
                    {
                      "name": "predicted_exhaustion_date",
                      "expression": "`predicted_exhaustion_date`"
                    },
                    {
                      "name": "days_until_exhaustion",
                      "expression": "`days_until_exhaustion`"
                    },
                    {
                      "name": "model_version",
                      "expression": "`model_version`"
                    },
                    {
                      "name": "exhaustion_status",
                      "expression": "`exhaustion_status`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "contract_id",
                    "displayName": "Contract",
                    "type": "string"
                  },
                  {
                    "fieldName": "commitment",
                    "displayName": "Commitment ($)",
                    "type": "number",
                    "numberFormat": "#,##0"
                  },
                  {
                    "fieldName": "predicted_exhaustion_date",
                    "displayName": "Predicted Exhaustion Date",
                    "type": "datetime",
                    "dateTimeFormat": "YYYY-MM-DD"
                  },
                  {
                    "fieldName": "days_until_exhaustion",
                    "displayName": "Days Until Exhaustion",
                    "type": "number"
                  },
                  {
                    "fieldName": "model_version",
                    "displayName": "Forecast Model",
                    "type": "string"
                  },
                  {
                    "fieldName": "exhaustion_status",
                    "displayName": "Status",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "Contract Exhaustion Prediction"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 15,
            "width": 6,
            "height": 3
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    },
    {
      "name": "page_whatif",
      "displayName": "What-If Analysis",
      "layout": [
        {
          "widget": {
            "name": "w_whatif_chart",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_whatif_scenarios",
                  "fields": [
                    {
                      "name": "date",
                      "expression": "`date`"
                    },
                    {
                      "name": "value",
                      "expression": "`value`"
                    },
                    {
                      "name": "series_type",
                      "expression": "`series_type`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 3,
              "widgetType": "line",
              "encodings": {
                "x": {
                  "fieldName": "date",
                  "scale": {
                    "type": "temporal"
                  },
                  "displayName": "Date"
                },
                "y": {
                  "fieldName": "value",
                  "scale": {
                    "type": "quantitative"
                  },
                  "displayName": "Cumulative Cost ($)"
                },
                "color": {
                  "fieldName": "series_type",
                  "scale": {
                    "type": "categorical",
                    "mappings": [
                      {
                        "value": "Baseline (No Discount)",
                        "color": "#FF0000"
                      },
                      {
                        "value": "5% Discount",
                        "color": "#90EE90"
                      },
                      {
                        "value": "10% Discount",
                        "color": "#00A972"
                      },
                      {
                        "value": "10% Discount (Max for 1yr)",
                        "color": "#00A972"
                      },
                      {
                        "value": "15% Discount",
                        "color": "#0078D4"
                      },
                      {
                        "value": "15% (If 2yr commit)",
                        "color": "#0078D4"
                      },
                      {
                        "value": "18% (If 3yr commit)",
                        "color": "#00008B"
                      },
                      {
                        "value": "20% Discount",
                        "color": "#00008B"
                      },
                      {
                        "value": "Contract Commitment",
                        "color": "#FFD700"
                      }
                    ]
                  },
                  "displayName": "Scenario"
                }
              },
              "frame": {
                "showTitle": true,
                "title": "What-If Discount Scenario Comparison"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 0,
            "width": 4,
            "height": 6
          }
        },
        {
          "widget": {
            "name": "w_sweet_spot",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_whatif_sweet_spot",
                  "fields": [
                    {
                      "name": "contract_id",
                      "expression": "`contract_id`"
                    },
                    {
                      "name": "scenario_name",
                      "expression": "`scenario_name`"
                    },
                    {
                      "name": "best_discount",
                      "expression": "`best_discount`"
                    },
                    {
                      "name": "savings",
                      "expression": "`savings`"
                    },
                    {
                      "name": "days_extended",
                      "expression": "`days_extended`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "contract_id",
                    "displayName": "Contract",
                    "type": "string"
                  },
                  {
                    "fieldName": "scenario_name",
                    "displayName": "Best Scenario",
                    "type": "string"
                  },
                  {
                    "fieldName": "best_discount",
                    "displayName": "Discount %",
                    "type": "number",
                    "numberFormat": "0"
                  },
                  {
                    "fieldName": "savings",
                    "displayName": "Savings ($)",
                    "type": "number",
                    "numberFormat": "#,##0"
                  },
                  {
                    "fieldName": "days_extended",
                    "displayName": "Days Extended",
                    "type": "number"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "Recommended Scenario (Sweet Spot)"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 0,
            "width": 2,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "w_longer_duration",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_whatif_longer_duration",
                  "fields": [
                    {
                      "name": "contract_id",
                      "expression": "`contract_id`"
                    },
                    {
                      "name": "opportunity",
                      "expression": "`opportunity`"
                    },
                    {
                      "name": "potential_discount",
                      "expression": "`potential_discount`"
                    },
                    {
                      "name": "potential_savings",
                      "expression": "`potential_savings`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "contract_id",
                    "displayName": "Contract",
                    "type": "string"
                  },
                  {
                    "fieldName": "opportunity",
                    "displayName": "If Extended To",
                    "type": "string"
                  },
                  {
                    "fieldName": "potential_discount",
                    "displayName": "Potential %",
                    "type": "number",
                    "numberFormat": "0"
                  },
                  {
                    "fieldName": "potential_savings",
                    "displayName": "Potential Savings ($)",
                    "type": "number",
                    "numberFormat": "#,##0"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "Incentive to Extend Duration"
              }
            }
          },
          "position": {
            "x": 4,
            "y": 3,
            "width": 2,
            "height": 3
          }
        },
        {
          "widget": {
            "name": "w_whatif_table",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_whatif_summary",
                  "fields": [
                    {
                      "name": "contract_id",
                      "expression": "`contract_id`"
                    },
                    {
                      "name": "scenario_name",
                      "expression": "`scenario_name`"
                    },
                    {
                      "name": "discount_pct",
                      "expression": "`discount_pct`"
                    },
                    {
                      "name": "savings_to_date",
                      "expression": "`savings_to_date`"
                    },
                    {
                      "name": "scenario_exhaustion_date",
                      "expression": "`scenario_exhaustion_date`"
                    },
                    {
                      "name": "days_extended",
                      "expression": "`days_extended`"
                    },
                    {
                      "name": "recommendation",
                      "expression": "`recommendation`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "contract_id",
                    "displayName": "Contract",
                    "type": "string"
                  },
                  {
                    "fieldName": "scenario_name",
                    "displayName": "Scenario",
                    "type": "string"
                  },
                  {
                    "fieldName": "discount_pct",
                    "displayName": "Discount %",
                    "type": "number",
                    "numberFormat": "0"
                  },
                  {
                    "fieldName": "savings_to_date",
                    "displayName": "Savings ($)",
                    "type": "number",
                    "numberFormat": "#,##0"
                  },
                  {
                    "fieldName": "scenario_exhaustion_date",
                    "displayName": "Exhaustion Date",
                    "type": "datetime",
                    "dateTimeFormat": "YYYY-MM-DD"
                  },
                  {
                    "fieldName": "days_extended",
                    "displayName": "Days Extended",
                    "type": "number"
                  },
                  {
                    "fieldName": "recommendation",
                    "displayName": "Status",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "All Discount Scenarios Comparison"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 6,
            "width": 6,
            "height": 5
          }
        },
        {
          "widget": {
            "name": "w_discount_tiers",
            "queries": [
              {
                "name": "main_query",
                "query": {
                  "datasetName": "ds_discount_tiers",
                  "fields": [
                    {
                      "name": "tier_name",
                      "expression": "`tier_name`"
                    },
                    {
                      "name": "commitment_range",
                      "expression": "`commitment_range`"
                    },
                    {
                      "name": "years",
                      "expression": "`years`"
                    },
                    {
                      "name": "max_discount",
                      "expression": "`max_discount`"
                    }
                  ],
                  "disaggregated": true
                }
              }
            ],
            "spec": {
              "version": 2,
              "widgetType": "table",
              "encodings": {
                "columns": [
                  {
                    "fieldName": "tier_name",
                    "displayName": "Tier",
                    "type": "string"
                  },
                  {
                    "fieldName": "commitment_range",
                    "displayName": "Commitment Range",
                    "type": "string"
                  },
                  {
                    "fieldName": "years",
                    "displayName": "Years",
                    "type": "number"
                  },
                  {
                    "fieldName": "max_discount",
                    "displayName": "Max Discount",
                    "type": "string"
                  }
                ]
              },
              "frame": {
                "showTitle": true,
                "title": "Discount Tier Reference (Longer Duration = Higher Discount)"
              }
            }
          },
          "position": {
            "x": 0,
            "y": 11,
            "width": 6,
            "height": 4
          }
        }
      ],
      "pageType": "PAGE_TYPE_CANVAS"
    }
  ],
  "uiSettings": {
    "theme": {
      "widgetHeaderAlignment": "ALIGNMENT_UNSPECIFIED"
    },
    "applyModeEnabled": false
  }
}

